(()=>{"use strict";var e;!function(e){e[e.A=0]="A",e[e.AS=1]="AS",e[e.B=2]="B",e[e.C=3]="C",e[e.CS=4]="CS",e[e.D=5]="D",e[e.DS=6]="DS",e[e.E=7]="E",e[e.F=8]="F",e[e.FS=9]="FS",e[e.G=10]="G",e[e.GS=11]="GS"}(e||(e={}));var t=[e.A,e.AS,e.B,e.C,e.CS,e.D,e.DS,e.E,e.F,e.FS,e.G,e.GS],i=function(e,t){this.pitch=e,this.octave=t};function n(e){return e.concat(e.map(function(e){return e+12}))}new i(e.A,0),new i(e.CS,0),new i(e.E,0),new i(e.GS,0),new i(e.GS,1);var a=[e.C,e.DS,e.F,e.FS,e.G,e.AS],r=[e.E,e.G,e.A,e.B,e.D],o=n(r),s=n(a),h=(n(t),{blues:a,blues2:s,pent:r,pent2:o,chrom:t}),c={devicePixelsPerUnit:50,oscillatorType:"sawtooth",scale:o,autoplayDelayScale:1,sustainTime:.05};function d(e,t){return e+t}var l,u,v,y,P,f="#333",m="#010",x=function(){function e(e,t,i,n){this.branches=[],this.x=0,this.y=0,this.angle=e,this.depth=t,this.maxSize=i,this.size=0,this.growthRateModifier=n*(.5+.5*Math.random())}return e.prototype.advance=function(e,t){var i=this.size===this.maxSize;if(!i){var n=t*this.growthRateModifier,a=this.size;this.size=Math.min(this.size+n,this.maxSize),a===this.size&&(i=!0),this.maybeBranch(n)}this.draw(e);for(var r=0,o=this.branches;r<o.length;r++)i=o[r].advance(e,t)&&i;return i},e.prototype.maybeBranch=function(t){var i=this.size/this.maxSize;if(i<.9&&i>.1&&this.depth>0&&4.5*Math.random()<t){var n=(Math.random()>.5?1:-1)*(.25*Math.random()+.25)*Math.PI,a=this.angle+n,r=(this.maxSize-this.size)*(.33+.33*Math.random()),o=this.depth-1,s=this.size,h=new e(a,o,r,.5*this.growthRateModifier),c=this.getCoordinatesAtSize(s);h.x=c.x,h.y=c.y,this.branches.push(h)}},e.prototype.draw=function(e){var t=this.getCoordinatesAtSize(this.size);e.fillStyle=f;var i,n,a,r,o=this.getBaseOffset();e.beginPath(),e.moveTo(t.x*c.devicePixelsPerUnit,t.y*c.devicePixelsPerUnit),e.lineTo((this.x+o.x1)*c.devicePixelsPerUnit,(this.y+o.y1)*c.devicePixelsPerUnit),e.lineTo(this.x*c.devicePixelsPerUnit,this.y*c.devicePixelsPerUnit),e.lineTo((this.x+o.x2)*c.devicePixelsPerUnit,(this.y+o.y2)*c.devicePixelsPerUnit),e.fill(),o.y1>o.y2?(i=o.x1,a=o.y1,n=o.x2,r=o.y2):(i=o.x2,a=o.y2,n=o.x1,r=o.y1),e.strokeStyle=m,e.lineWidth=1;for(var s=7;s<=10;s++)e.beginPath(),e.moveTo(t.x*c.devicePixelsPerUnit,t.y*c.devicePixelsPerUnit),e.lineTo((this.x+i*s/10)*c.devicePixelsPerUnit,(this.y+a*s/10)*c.devicePixelsPerUnit),e.stroke();e.strokeStyle="#544",e.lineWidth=1,e.beginPath(),e.moveTo(t.x*c.devicePixelsPerUnit,t.y*c.devicePixelsPerUnit),e.lineTo((this.x+.9*n)*c.devicePixelsPerUnit,(this.y+.9*r)*c.devicePixelsPerUnit),e.stroke(),e.beginPath(),e.moveTo(t.x*c.devicePixelsPerUnit,t.y*c.devicePixelsPerUnit),e.lineTo((this.x+n)*c.devicePixelsPerUnit,(this.y+r)*c.devicePixelsPerUnit),e.stroke()},e.prototype.getCoordinatesAtSize=function(e){var t=e;return{x:this.x+Math.cos(this.angle)*t,y:this.y+Math.sin(this.angle)*t}},e.prototype.getBaseOffset=function(){var e=.05*this.size,t=this.angle+Math.PI/4,i=Math.cos(t)*e,n=Math.sin(t)*e,a=this.angle-Math.PI/4;return{x1:i,y1:n,x2:Math.cos(a)*e,y2:Math.sin(a)*e}},e.prototype.getTotalCount=function(){return 1+this.branches.map(function(e){return e.getTotalCount()}).reduce(d,0)},e.prototype.dispose=function(){for(var e=0,t=this.branches;e<t.length;e++)t[e].dispose();this.branches=[]},e}(),p=1.5,g=0,w=!1,S=0,M=[],U="",C=!1;function T(){P.className=P.className?"":"hidden"}function b(){var e=S;if(e<v.textContent.length){S++;var t=v.textContent.charAt(e),i=z(t);k(t.charCodeAt(0)),setTimeout(b,i)}}function z(e){y.appendChild(document.createTextNode(e));var t=e.match(/[a-z]/i)?25:100;"\n"===e||"\r\n"===e?(t=300,function(e){var t=e.match(/set oscillatorType (sawtooth|sine|triangle|square)/i);if(t)c.oscillatorType=t[1].toLowerCase();else{var i=e.match(/set autoplayDelayScale ([\d.]+)/i);if(i)c.autoplayDelayScale=parseInt(i[1],10);else{var n=e.match(/set sustainTime ([\d.]+)/i);if(n)c.sustainTime=parseInt(n[1],10);else{var a=e.match(/set scale ([\w\d]+)/i);if(a){var r=h[a[1]];r&&(c.scale=r)}}}}}(U),U=""):U+=e;var i=t*(.25+.75*Math.random());return P.scrollIntoView(),i*c.autoplayDelayScale}var A,E={};function k(e,t,i){void 0===t&&(t=!1),void 0===i&&(i=c.scale);var n=(!A&&C&&(A=new(window.AudioContext||window.webkitAudioContext)),A);if(!(t&&E[e]||!n)){var a=n.createOscillator(),r=n.createGain();r.gain.value=.25,a.type=c.oscillatorType,a.frequency.value=220*Math.pow(2,i[e%i.length]/12),a.connect(r).connect(n.destination),a.start(n.currentTime),t?E[e]=function(){return a.stop(n.currentTime)}:a.stop(n.currentTime+c.sustainTime)}}function D(){!function(){for(var e=0,t=M;e<t.length;e++)t[e].dispose();M.length=0,u.reset()}(),I(),w||requestAnimationFrame(B)}function I(){var e=window.devicePixelRatio;c.devicePixelsPerUnit=50*e,l.width=window.innerWidth*e,l.height=window.innerHeight*e;var t=1/e;l.style.transform="scale("+t+","+t+")",function(){u.fillStyle=f,u.fillRect(0,l.height-c.devicePixelsPerUnit*p,l.width,c.devicePixelsPerUnit*p),u.strokeStyle=m,u.lineWidth=1;for(var e=[4,12,16,18,19,20],t=0;t<e.length;t++)u.beginPath(),u.moveTo(0,l.height-p*c.devicePixelsPerUnit*e[t]/20),u.lineTo(l.width,l.height-p*c.devicePixelsPerUnit*e[t]/20),u.stroke()}(),function(){for(var e=Math.max(15,l.width/c.devicePixelsPerUnit*1.3),t=[],i=0;i<e;i++)t.push(Math.random());for(t.sort(),i=t.length-1;i>=0;i--){var n=(.25*Math.random()+1.375)*Math.PI,a=3+Math.round(2*Math.random()),r=l.height/c.devicePixelsPerUnit*(1-t[i]),o=new x(n,a,r*(1-Math.random()*Math.random()*.5),1-t[i]);o.x=l.width*Math.random()/c.devicePixelsPerUnit,o.y=l.height/c.devicePixelsPerUnit-t[i]*p,M.push(o)}}()}function B(e){w=!0;for(var t=(e-g)/1e3*3,i=!0,n=0,a=M;n<a.length;n++)i=a[n].advance(u,t)&&i;g=e,i?w=!1:requestAnimationFrame(B)}function F(){var e=Math.floor(26*Math.random()).toString(16);1===e.length&&(e="0"+e),(new Date).getMilliseconds()%500<250?document.body.style.backgroundColor=e+"0000":document.body.style.backgroundColor="00"+e+"00"}function G(e){C=!0,e.repeat||(k(e.which,!0),8===e.which&&y.lastChild&&y.lastChild.remove())}function L(e){if(!e.repeat){var t=String.fromCharCode(e.which);13===e.which?z("\r\n"):z(t)}}function q(e){var t=e.which,i=E[t];i&&(delete E[t],i())}function R(){C=!0}function O(){for(var e in E)E.hasOwnProperty(e)&&E[e]();E={}}addEventListener("load",function(){l=document.getElementById("spike-field"),u=l.getContext("2d"),v=document.getElementById("content-full"),y=document.getElementById("content-text"),P=document.getElementById("cursor"),I(),addEventListener("resize",D),requestAnimationFrame(B),setInterval(F,.25),setInterval(T,500);var e=window.location.hash;e&&(v.textContent=unescape(e.substring(1))),b(),document.body.addEventListener("keypress",L),document.body.addEventListener("keydown",G),document.body.addEventListener("keyup",q),document.body.addEventListener("pointerdown",R),window.addEventListener("blur",O)})})();
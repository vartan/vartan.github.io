(()=>{"use strict";var e;!function(e){e[e.A=0]="A",e[e.AS=1]="AS",e[e.B=2]="B",e[e.C=3]="C",e[e.CS=4]="CS",e[e.D=5]="D",e[e.DS=6]="DS",e[e.E=7]="E",e[e.F=8]="F",e[e.FS=9]="FS",e[e.G=10]="G",e[e.GS=11]="GS"}(e||(e={}));var t=[e.A,e.AS,e.B,e.C,e.CS,e.D,e.DS,e.E,e.F,e.FS,e.G,e.GS],i=function(e,t){this.pitch=e,this.octave=t};function n(e){return e.concat(e.map(function(e){return e+12}))}new i(e.A,0),new i(e.CS,0),new i(e.E,0),new i(e.GS,0),new i(e.GS,1);var r=[e.C,e.DS,e.F,e.FS,e.G,e.AS],o=[e.E,e.G,e.A,e.B,e.D],s=n(o),a=n(r),h=(n(t),{blues:r,blues2:a,pent:o,pent2:s,chrom:t}),c={devicePixelsPerUnit:50,oscillatorType:"sawtooth",scale:s};function d(e,t){return e+t}var l,v,u,P,x,f="#333",m="#010",y=function(){function e(e,t,i,n){this.branches=[],this.x=0,this.y=0,this.angle=e,this.depth=t,this.maxSize=i,this.size=0,this.growthRateModifier=n*(.5+.5*Math.random())}return e.prototype.advance=function(e,t){var i=this.size===this.maxSize;if(!i){var n=t*this.growthRateModifier,r=this.size;this.size=Math.min(this.size+n,this.maxSize),r===this.size&&(i=!0),this.maybeBranch(n)}this.draw(e);for(var o=0,s=this.branches;o<s.length;o++)i=s[o].advance(e,t)&&i;return i},e.prototype.maybeBranch=function(t){var i=this.size/this.maxSize;if(i<.9&&i>.1&&this.depth>0&&4.5*Math.random()<t){var n=(Math.random()>.5?1:-1)*(.25*Math.random()+.25)*Math.PI,r=this.angle+n,o=(this.maxSize-this.size)*(.33+.33*Math.random()),s=this.depth-1,a=this.size,h=new e(r,s,o,.5*this.growthRateModifier),c=this.getCoordinatesAtSize(a);h.x=c.x,h.y=c.y,this.branches.push(h)}},e.prototype.draw=function(e){var t=this.getCoordinatesAtSize(this.size);e.fillStyle=f;var i,n,r,o,s=this.getBaseOffset();e.beginPath(),e.moveTo(t.x*c.devicePixelsPerUnit,t.y*c.devicePixelsPerUnit),e.lineTo((this.x+s.x1)*c.devicePixelsPerUnit,(this.y+s.y1)*c.devicePixelsPerUnit),e.lineTo(this.x*c.devicePixelsPerUnit,this.y*c.devicePixelsPerUnit),e.lineTo((this.x+s.x2)*c.devicePixelsPerUnit,(this.y+s.y2)*c.devicePixelsPerUnit),e.fill(),s.y1>s.y2?(i=s.x1,r=s.y1,n=s.x2,o=s.y2):(i=s.x2,r=s.y2,n=s.x1,o=s.y1),e.strokeStyle=m,e.lineWidth=1;for(var a=7;a<=10;a++)e.beginPath(),e.moveTo(t.x*c.devicePixelsPerUnit,t.y*c.devicePixelsPerUnit),e.lineTo((this.x+i*a/10)*c.devicePixelsPerUnit,(this.y+r*a/10)*c.devicePixelsPerUnit),e.stroke();e.strokeStyle="#544",e.lineWidth=1,e.beginPath(),e.moveTo(t.x*c.devicePixelsPerUnit,t.y*c.devicePixelsPerUnit),e.lineTo((this.x+.9*n)*c.devicePixelsPerUnit,(this.y+.9*o)*c.devicePixelsPerUnit),e.stroke(),e.beginPath(),e.moveTo(t.x*c.devicePixelsPerUnit,t.y*c.devicePixelsPerUnit),e.lineTo((this.x+n)*c.devicePixelsPerUnit,(this.y+o)*c.devicePixelsPerUnit),e.stroke()},e.prototype.getCoordinatesAtSize=function(e){var t=e;return{x:this.x+Math.cos(this.angle)*t,y:this.y+Math.sin(this.angle)*t}},e.prototype.getBaseOffset=function(){var e=.05*this.size,t=this.angle+Math.PI/4,i=Math.cos(t)*e,n=Math.sin(t)*e,r=this.angle-Math.PI/4;return{x1:i,y1:n,x2:Math.cos(r)*e,y2:Math.sin(r)*e}},e.prototype.getTotalCount=function(){return 1+this.branches.map(function(e){return e.getTotalCount()}).reduce(d,0)},e.prototype.dispose=function(){for(var e=0,t=this.branches;e<t.length;e++)t[e].dispose();this.branches=[]},e}(),g=1.5,w=0,p=!1,S=0,M=[],U="",C=!1;function b(){x.className=x.className?"":"hidden"}function T(){var e=S;if(e<u.textContent.length){S++;var t=u.textContent.charAt(e),i=z(t);k(t.charCodeAt(0)),setTimeout(T,i)}}function z(e){P.appendChild(document.createTextNode(e));var t=e.match(/[a-z]/i)?25:100;"\n"===e||"\r\n"===e?(t=300,function(e){var t=e.match(/set oscillatorType (sawtooth|sine|triangle|square)/i);if(t)c.oscillatorType=t[1].toLowerCase();else{var i=e.match(/set scale ([\w\d]+)/i);if(i){var n=h[i[1]];n&&(c.scale=n)}}}(U),U=""):U+=e;var i=t*(.25+.75*Math.random());return x.scrollIntoView(),i}var A,E={};function k(e,t,i){void 0===t&&(t=!1),void 0===i&&(i=c.scale);var n=(!A&&C&&(A=new(window.AudioContext||window.webkitAudioContext)),A);if(!(t&&E[e]||!n)){var r=n.createOscillator(),o=n.createGain();o.gain.value=.25,r.type=c.oscillatorType,r.frequency.value=220*Math.pow(2,i[e%i.length]/12),r.connect(o).connect(n.destination),r.start(n.currentTime),t?E[e]=function(){return r.stop(n.currentTime)}:r.stop(n.currentTime+.05)}}function B(){!function(){for(var e=0,t=M;e<t.length;e++)t[e].dispose();M.length=0,v.reset()}(),F(),p||requestAnimationFrame(G)}function F(){var e=window.devicePixelRatio;c.devicePixelsPerUnit=50*e,l.width=window.innerWidth*e,l.height=window.innerHeight*e;var t=1/e;l.style.transform="scale("+t+","+t+")",function(){v.fillStyle=f,v.fillRect(0,l.height-c.devicePixelsPerUnit*g,l.width,c.devicePixelsPerUnit*g),v.strokeStyle=m,v.lineWidth=1;for(var e=[4,12,16,18,19,20],t=0;t<e.length;t++)v.beginPath(),v.moveTo(0,l.height-g*c.devicePixelsPerUnit*e[t]/20),v.lineTo(l.width,l.height-g*c.devicePixelsPerUnit*e[t]/20),v.stroke()}(),function(){for(var e=Math.max(15,l.width/c.devicePixelsPerUnit*1.3),t=[],i=0;i<e;i++)t.push(Math.random());for(t.sort(),i=t.length-1;i>=0;i--){var n=(.25*Math.random()+1.375)*Math.PI,r=3+Math.round(2*Math.random()),o=l.height/c.devicePixelsPerUnit*(1-t[i]),s=new y(n,r,o*(1-Math.random()*Math.random()*.5),1-t[i]);s.x=l.width*Math.random()/c.devicePixelsPerUnit,s.y=l.height/c.devicePixelsPerUnit-t[i]*g,M.push(s)}}()}function G(e){p=!0;for(var t=(e-w)/1e3*3,i=!0,n=0,r=M;n<r.length;n++)i=r[n].advance(v,t)&&i;w=e,i?p=!1:requestAnimationFrame(G)}function I(){var e=Math.floor(26*Math.random()).toString(16);1===e.length&&(e="0"+e),(new Date).getMilliseconds()%500<250?document.body.style.backgroundColor=e+"0000":document.body.style.backgroundColor="00"+e+"00"}function D(e){C=!0,e.repeat||(k(e.which,!0),8===e.which&&P.lastChild&&P.lastChild.remove())}function L(e){if(!e.repeat){var t=String.fromCharCode(e.which);13===e.which?z("\r\n"):z(t)}}function q(e){var t=e.which,i=E[t];i&&(delete E[t],i())}function R(){C=!0}function O(){for(var e in E)E.hasOwnProperty(e)&&E[e]();E={}}addEventListener("load",function(){l=document.getElementById("spike-field"),v=l.getContext("2d"),u=document.getElementById("content-full"),P=document.getElementById("content-text"),x=document.getElementById("cursor"),F(),addEventListener("resize",B),requestAnimationFrame(G),setInterval(I,.25),setInterval(b,500);var e=window.location.hash;e&&(u.textContent=unescape(e.substring(1))),T(),document.body.addEventListener("keypress",L),document.body.addEventListener("keydown",D),document.body.addEventListener("keyup",q),document.body.addEventListener("pointerdown",R),window.addEventListener("blur",O)})})();